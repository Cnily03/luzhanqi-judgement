window.console.debug=function(){window.isEnvDev&&window.console.log(...arguments)};const messages={parse:function(s){for(let e=1;e<arguments.length;e++){var t=arguments[e];s=(s=2==arguments.length?s.replace(RegExp("%s","g"),t):s).replace(RegExp("%"+e.toString()+"s","g"),t)}return s},vanilla:{":junqi-boom:black":"<font color='#000'>\u9ed1\u68cb</font> \u519b\u65d7\u88ab\u70b8\uff01",":junqi-boom:red":"<font color='#f00'>\u7ea2\u68cb</font> \u519b\u65d7\u88ab\u70b8\uff01",":junqi-holder:black":"<font color='#f00'>\u7ea2\u68cb</font> \u519b\u65d7\u88ab <font color='#000'>\u9ed1\u68cb</font> \u593a\u53bb\uff01",":junqi-holder:red":"<font color='#000'>\u9ed1\u68cb</font> \u519b\u65d7\u88ab <font color='#f00'>\u7ea2\u68cb</font> \u593a\u53bb\uff01"},join:"%1s \u52a0\u5165\u4e86\u623f\u95f4\u3002",leave:"%1s \u79bb\u5f00\u4e86\u623f\u95f4\u3002",team:"%1s \u52a0\u5165\u4e86 %2s \u9635\u8425\u3002",select:"%1s \u9009\u62e9 %2s \u5b8c\u6bd5\u3002",reset_on:"%1s\uff08%2s\uff09\u8bf7\u6c42\u91cd\u7f6e\u6e38\u620f\uff0c\u53cc\u65b9\u5747\u53d1\u8d77\u8bf7\u6c42\u5c06\u91cd\u7f6e\u6e38\u620f\u3002",reset_off:"%1s\uff08%2s\uff09\u53d6\u6d88\u4e86\u91cd\u7f6e\u6e38\u620f\u7684\u8bf7\u6c42\u3002",reset_reset:"\u6e38\u620f\u91cd\u7f6e\u6210\u529f\uff01",winner_head:"\u5224\u5b9a\u7ed3\u679c\uff1a%1s",winner:{black:"%2s \u6218\u8d25\uff0c%1s \u7565\u80dc\u4e00\u7b79\u3002",red:"%2s \u6218\u8d25\uff0c%1s \u7565\u80dc\u4e00\u7b79\u3002",bothdie:"\u540c\u5f52\u4e8e\u5c3d\uff01",invalid:"\u5403\u5b50\u65e0\u6548\uff0c\u7ee7\u7eed\u5bf9\u5cd9\uff01",allwin:"\u6e38\u620f\u7ed3\u675f\uff0c%1s\u83b7\u80dc\uff01",error:"\u8f93\u5165\u9519\u8bef\uff01"}},CONFIG={name:{resetGame:"reset-game"},id:{messageBox:"message-box"},class:{activeTeam:"team-selected",activeChess:"chess-selected",oneMessage:"one-message",messageTime:"message-time"}},reflex={entozh:{black:"\u9ed1\u68cb",red:"\u7ea2\u68cb"},zhtoen:{"\u9ed1\u68cb":"black","\u7ea2\u68cb":"red"},entozh_color:{black:"<font color='#000'>\u9ed1\u68cb</font>",red:"<font color='#f00'>\u7ea2\u68cb</font>"},colormap:{black:"#000",red:"#f00",default:"#0078d4",bothdie:"#32b643",invalid:"#32b643",error:"#fc9a03"},colorifyText:(e,s)=>`<font color='${s.includes("#")?s:reflex.colormap[s]}'>`+e+"</font>"};var globalTeam="default";const updateTeam=(e=globalTeam)=>{globalTeam=e;const s=document.querySelector(".select-team #"+globalTeam),t=document.querySelector(".select-team #"+{black:"red",red:"black"}[globalTeam]);s.classList.add(CONFIG.class.activeTeam),t.classList.remove(CONFIG.class.activeTeam),document.querySelector(".chess-board").classList.remove("disabled"),document.documentElement.style.setProperty("--team-color",reflex.colormap[globalTeam])},setResetGameStatus=function(e){document.querySelector(`input[name='${CONFIG.name.resetGame}']`).checked=!!e},resetGame=()=>{changeToWaitChess(),setResetGameStatus(!1)},changeToWaitChess=()=>{window.isOnSubmit=!1,document.querySelector("#submit-chess").style.pointerEvents="all";for(var e of document.querySelectorAll("#chess .chess-btn"))e.classList.remove(CONFIG.class.activeChess)},messageBox={element:null,clear:()=>{messageBox.element.innerHTML=""},append:(e,s,t="default")=>{let a=document.createElement("div"),o=document.createElement("div");a.classList.add(CONFIG.class.oneMessage),a.classList.add("tag-"+t),o.classList.add(CONFIG.class.messageTime),o.innerHTML=`[${e}] `,a.appendChild(o),a.innerHTML+=s,messageBox.element.appendChild(a),document.querySelector("#message-box").scrollTop=document.querySelector("#message-box").scrollHeight}},wsHandler=()=>{window.ws=new WebSocket("ws://"+window.ws_url),ws.onopen=e=>{ws.send("join: ")},ws.onclose=e=>{messageBox.append((new Date).toTimeString().split(" ")[0],"\u8fde\u63a5\u8d85\u65f6\uff0c\u5df2\u65ad\u5f00\u8fde\u63a5\u3002")},ws.onmessage=e=>{var s=e.data.split(" | ")[0],e=e.data.split(" | ")[1];messageHandler(s,e)}},messageHandler=(t,a)=>{switch(console.debug(a),!0){case/^vanilla: /.test(a):var e=a.split("vanilla: ")[1].trim();Object.keys(messages.vanilla).includes(e)?messageBox.append(t,messages.vanilla[e]):messageBox.append(t,e);break;case/^local:error: /.test(a):{let e=a.split("local:error: ")[1].trim().split(" ");var s=e[0].trim();e[1].trim();["select"].includes(s)&&changeToWaitChess();break}case/^join: /.test(a):{let e=a.split("join: ")[1].trim().split(" ");var o=e[0].trim(),s=e[1].trim(),o=messages.parse(messages.join,reflex.colorifyText(s,o));messageBox.append(t,o);break}case/^leave: /.test(a):o=a.split("leave: ")[1].trim(),o=messages.parse(messages.leave,o);messageBox.append(t,o);break;case/^team: /.test(a):{let e=a.split("team: ")[1].trim().split(" ");var l=e[0].trim(),n=e[1].trim(),r=messages.parse(messages.team,reflex.colorifyText(n,l),reflex.entozh_color[l]);messageBox.append(t,r);break}case/^local:team: /.test(a):{let e=a.split("local:team: ")[1].trim().split(" ");n=e[0].trim(),l=e[1].trim(),r=e[2].trim();updateTeam(n),changeToWaitChess(),"none"!=l&&document.querySelector("#chess .chess-btn#"+l).click(),setResetGameStatus(!!parseInt(r));break}case/^select: /.test(a):{let e=a.split("select: ")[1].trim().split(" ");var c=e[0].trim(),i=e[1].trim(),m=messages.parse(messages.select,reflex.colorifyText(i,c),reflex.entozh_color[c]);messageBox.append(t,m);break}case/^win: /.test(a):{let e=a.split("win: ")[1].trim(),s;["black","red"].includes(e)?s=messages.parse(messages.winner_head,messages.parse(messages.winner[e],reflex.entozh_color[e],reflex.entozh_color[{black:"red",red:"black"}[e]])):"bothdie"==e?s=messages.parse(messages.winner_head,reflex.colorifyText(messages.winner.bothdie,"bothdie")):"invalid"==e?s=messages.parse(messages.winner_head,reflex.colorifyText(messages.winner.invalid,"invalid")):"allwin"==e.split(":")[0]?(s=messages.parse(messages.winner.allwin,reflex.entozh_color[e.split(":")[1]]),resetGame()):"error"==e&&(s=reflex.colorifyText(messages.winner[e],e)),messageBox.append(t,s),changeToWaitChess();break}case/^reset: /.test(a):{let e=a.split("reset: ")[1].trim().split(" ");i=e[0].trim(),c=e[1].trim(),m=e[2].trim();"reset"==i?resetGame():globalTeam==c&&(document.querySelector(`input[name='${CONFIG.name.resetGame}']`).checked={on:!0,off:!1}[i]);c=messages.parse(messages["reset_"+i],reflex.colorifyText(m,c),reflex.entozh_color[c]);messageBox.append(t,c);break}}};window.WebSocket||document.write("\u8be5\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 WebSocket<br>This browser does not support WebSocket."),document.addEventListener("DOMContentLoaded",()=>{var s=document.querySelectorAll("#info #copy-btn");for(let e=0;e<s.length;e++){const t=s[e];t.onclick=()=>{t.classList.contains("oncopy")||setClipboard(t.parentElement.previousElementSibling.children[0].value,"text",e=>{e?(t.innerHTML="\u590d\u5236\u6210\u529f",t.classList.add("oncopy"),setTimeout(()=>{t.innerHTML="\u590d\u5236",t.classList.remove("oncopy")},1e3)):(window._runClipboard||(alert("\u4f60\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u81ea\u52a8\u590d\u5236\uff0c\u8bf7\u624b\u52a8\u590d\u5236\u3002"),window._runClipboard=!0),t.parentElement.previousElementSibling.children[0].select(),t.innerHTML="\u5df2\u9009\u4e2d",t.classList.add("oncopy"),setTimeout(()=>{t.innerHTML="\u9009\u4e2d",t.classList.remove("oncopy")},1e3))})}}messageBox.element=document.querySelector("#"+CONFIG.id.messageBox),window.ws_url=document.querySelector("#_ws-url").innerHTML,document.body.removeChild(document.querySelector("#_ws-url")),wsHandler();for(let e of document.querySelector(".select-team").children)e.onclick=()=>{ws.send("team: "+e.id)};document.querySelector(`input[name='${CONFIG.name.resetGame}']`).onchange=()=>{const e=document.querySelector(`input[name='${CONFIG.name.resetGame}']`).checked;var s;"default"!=globalTeam?(s={true:"on",false:"off"}[e.toString()],ws.send(`reset: ${s} `+globalTeam)):document.querySelector(`input[name='${CONFIG.name.resetGame}']`).checked=!e},window.isOnSubmit=!1;for(let s of document.querySelectorAll("#chess .chess-btn"))s.onclick=()=>{if(!window.isOnSubmit)if(s.classList.contains(CONFIG.class.activeChess))s.classList.remove(CONFIG.class.activeChess);else{for(var e of document.querySelectorAll("#chess .chess-btn"))e.classList.remove(CONFIG.class.activeChess);s.classList.add(CONFIG.class.activeChess)}};document.querySelector("#submit-chess").onclick=()=>{var e=document.querySelector("#chess .chess-btn."+CONFIG.class.activeChess);window.isOnSubmit||null===e||(window.isOnSubmit=!0,document.querySelector("#submit-chess").style.pointerEvents="none",e=e.id,ws.send(`select: ${globalTeam} `+e))}});